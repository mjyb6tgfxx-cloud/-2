<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Deavil Zombie</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
}
#game{
  position:relative;
  width:100vw;
  height:56.25vw;       /* 16:9 */
  max-width:177.77vh;
  max-height:100vh;
  margin:auto;
  background:#111;
  touch-action:none;
}
#player{
  position:absolute;
  left:50%;
  top:50%;
  width:30px;
  height:30px;
  background:#0f0;
  border-radius:50%;
  transform:translate(-50%,-50%);
}
.zombie{
  position:absolute;
  width:30px;
  height:30px;
  background:#900;
  border-radius:50%;
}
.hp{
  position:absolute;
  top:-6px;
  left:0;
  width:100%;
  height:4px;
  background:#300;
}
.hp div{
  height:100%;
  background:#f00;
}
#waveUI{
  position:absolute;
  top:10px;
  left:10px;
  color:#fff;
  font-size:14px;
}
#hit{
  position:absolute;
  inset:0;
  background:red;
  opacity:0;
  pointer-events:none;
  transition:0.2s;
}
</style>
</head>

<body>
<div id="game">
  <div id="player"></div>
  <div id="waveUI">WAVE 1</div>
  <div id="hit"></div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const hit = document.getElementById("hit");
const waveUI = document.getElementById("waveUI");

let px = game.clientWidth / 2;
let py = game.clientHeight / 2;
let playerHP = 100;

let zombies = [];
let wave = 1;

/* ===== 좀비 생성 ===== */
function spawn(){
  const z = document.createElement("div");
  z.className = "zombie";
  z.hp = 30;
  z.x = Math.random() * game.clientWidth;
  z.y = Math.random() * game.clientHeight;

  const bar = document.createElement("div");
  bar.className = "hp";
  const fill = document.createElement("div");
  bar.appendChild(fill);
  z.appendChild(bar);
  z.fill = fill;

  game.appendChild(z);
  zombies.push(z);
}

/* ===== 웨이브 ===== */
function startWave(){
  waveUI.innerText = "WAVE " + wave;
  for(let i=0;i<wave*3;i++){
    spawn();
  }
}
function checkWave(){
  if(zombies.length === 0){
    wave++;
    setTimeout(startWave,2000);
  }
}

/* ===== 자동 공격 ===== */
setInterval(()=>{
  if(zombies.length === 0) return;

  let target = zombies.reduce((a,b)=>{
    let da = Math.hypot(a.x - px, a.y - py);
    let db = Math.hypot(b.x - px, b.y - py);
    return da < db ? a : b;
  });

  target.hp -= 10;
  target.fill.style.width = (target.hp / 30 * 100) + "%";

  if(target.hp <= 0){
    target.remove();
    zombies = zombies.filter(z => z !== target);
  }
}, 500);

/* ===== 메인 루프 ===== */
function loop(){
  zombies.forEach(z=>{
    let dx = px - z.x;
    let dy = py - z.y;
    let d = Math.hypot(dx,dy);

    z.x += dx / d;
    z.y += dy / d;
    z.style.left = z.x + "px";
    z.style.top = z.y + "px";

    if(d < 25){
      playerHP--;
      hit.style.opacity = 0.5;
      setTimeout(()=>hit.style.opacity=0,100);

      if(playerHP <= 0){
        alert("GAME OVER");
        location.reload();
      }
    }
  });

  checkWave();
  requestAnimationFrame(loop);
}

/* ===== 시작 ===== */
startWave();
loop();
</script>
</body>
</html>
